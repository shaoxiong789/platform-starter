<template>
  <div class="js_textArea inner no_extra">
    <div class="emotion_editor">
      <div class="edit_area js_editorArea" contenteditable="true" style="overflow-y: auto; overflow-x: hidden;"
      @input="changeText($event)" v-text="innerText">
      </div>
      <div class="editor_toolbar">
        <a href="javascript:void(0);" @click.stop="trigger_emotions" class="icon_emotion emotion_switch js_switch">Ë°®ÊÉÖ</a>
        <p class="editor_tip js_editorTip">ËøòÂèØ‰ª•ËæìÂÖ•<em>600</em>Â≠ó</p>
        <div class="emotion_wrp js_emotionArea" v-show="emotions_show">
          <span class="hook">
            <span class="hook_dec hook_top"></span>
            <span class="hook_dec hook_btm"></span>
          </span>
          <ul class="emotions" @blur="trigger_emotions" onselectstart="return false;">

            <li class="emotions_item">
              <span class="icon_emotion_sprite js_emotion_i" data-name="icon_smiley_0" data-title="[ÂæÆÁ¨ë]" style="background-position:0 -0px;"></span>
            </li>

            <li class="emotions_item">
              <span class="icon_emotion_sprite js_emotion_i" data-name="icon_smiley_1" data-title="[ÊíáÂò¥]" style="background-position:0 -20px;"></span>
            </li>

            <li class="emotions_item">
              <span class="icon_emotion_sprite js_emotion_i" data-name="icon_smiley_2" data-title="[Ëâ≤]" style="background-position:0 -40px;"></span>
            </li>

            <li class="emotions_item">
              <span class="icon_emotion_sprite js_emotion_i" data-name="icon_smiley_3" data-title="[ÂèëÂëÜ]" style="background-position:0 -60px;"></span>
            </li>

            <li class="emotions_item">
              <span class="icon_emotion_sprite js_emotion_i" data-name="icon_smiley_4" data-title="[ÂæóÊÑè]" style="background-position:0 -80px;"></span>
            </li>

            <li class="emotions_item">
              <span class="icon_emotion_sprite js_emotion_i" data-name="icon_smiley_5" data-title="[ÊµÅÊ≥™]" style="background-position:0 -100px;"></span>
            </li>

            <li class="emotions_item">
              <span class="icon_emotion_sprite js_emotion_i" data-name="icon_smiley_6" data-title="[ÂÆ≥Áæû]" style="background-position:0 -120px;"></span>
            </li>

            <li class="emotions_item">
              <span class="icon_emotion_sprite js_emotion_i" data-name="icon_smiley_7" data-title="[Èó≠Âò¥]" style="background-position:0 -140px;"></span>
            </li>

            <li class="emotions_item">
              <span class="icon_emotion_sprite js_emotion_i" data-name="icon_smiley_8" data-title="[Áù°]" style="background-position:0 -160px;"></span>
            </li>

            <li class="emotions_item">
              <span class="icon_emotion_sprite js_emotion_i" data-name="icon_smiley_9" data-title="[Â§ßÂì≠]" style="background-position:0 -180px;"></span>
            </li>

            <li class="emotions_item">
              <span class="icon_emotion_sprite js_emotion_i" data-name="icon_smiley_10" data-title="[Â∞¥Â∞¨]" style="background-position:0 -200px;"></span>
            </li>

            <li class="emotions_item">
              <span class="icon_emotion_sprite js_emotion_i" data-name="icon_smiley_11" data-title="[ÂèëÊÄí]" style="background-position:0 -220px;"></span>
            </li>

            <li class="emotions_item">
              <span class="icon_emotion_sprite js_emotion_i" data-name="icon_smiley_12" data-title="[Ë∞ÉÁöÆ]" style="background-position:0 -240px;"></span>
            </li>

            <li class="emotions_item">
              <span class="icon_emotion_sprite js_emotion_i" data-name="icon_smiley_13" data-title="[Âë≤Áâô]" style="background-position:0 -260px;"></span>
            </li>

            <li class="emotions_item">
              <span class="icon_emotion_sprite js_emotion_i" data-name="icon_smiley_14" data-title="[ÊÉäËÆ∂]" style="background-position:0 -280px;"></span>
            </li>

            <li class="emotions_item">
              <span class="icon_emotion_sprite js_emotion_i" data-name="icon_smiley_15" data-title="[ÈöæËøá]" style="background-position:0 -300px;"></span>
            </li>

            <li class="emotions_item">
              <span class="icon_emotion_sprite js_emotion_i" data-name="icon_smiley_17" data-title="[ÂÜ∑Ê±ó]" style="background-position:0 -320px;"></span>
            </li>

            <li class="emotions_item">
              <span class="icon_emotion_sprite js_emotion_i" data-name="icon_smiley_18" data-title="[ÊäìÁãÇ]" style="background-position:0 -340px;"></span>
            </li>

            <li class="emotions_item">
              <span class="icon_emotion_sprite js_emotion_i" data-name="icon_smiley_19" data-title="[Âêê]" style="background-position:0 -360px;"></span>
            </li>

            <li class="emotions_item">
              <span class="icon_emotion_sprite js_emotion_i" data-name="icon_smiley_20" data-title="[ÂÅ∑Á¨ë]" style="background-position:0 -380px;"></span>
            </li>

            <li class="emotions_item">
              <span class="icon_emotion_sprite js_emotion_i" data-name="icon_smiley_21" data-title="[ÊÑâÂø´]" style="background-position:0 -400px;"></span>
            </li>

            <li class="emotions_item">
              <span class="icon_emotion_sprite js_emotion_i" data-name="icon_smiley_22" data-title="[ÁôΩÁúº]" style="background-position:0 -420px;"></span>
            </li>

            <li class="emotions_item">
              <span class="icon_emotion_sprite js_emotion_i" data-name="icon_smiley_23" data-title="[ÂÇ≤ÊÖ¢]" style="background-position:0 -440px;"></span>
            </li>

            <li class="emotions_item">
              <span class="icon_emotion_sprite js_emotion_i" data-name="icon_smiley_25" data-title="[Âõ∞]" style="background-position:0 -460px;"></span>
            </li>

            <li class="emotions_item">
              <span class="icon_emotion_sprite js_emotion_i" data-name="icon_smiley_26" data-title="[ÊÉäÊÅê]" style="background-position:0 -480px;"></span>
            </li>

            <li class="emotions_item">
              <span class="icon_emotion_sprite js_emotion_i" data-name="icon_smiley_27" data-title="[ÊµÅÊ±ó]" style="background-position:0 -500px;"></span>
            </li>

            <li class="emotions_item">
              <span class="icon_emotion_sprite js_emotion_i" data-name="icon_smiley_28" data-title="[ÊÜ®Á¨ë]" style="background-position:0 -520px;"></span>
            </li>

            <li class="emotions_item">
              <span class="icon_emotion_sprite js_emotion_i" data-name="icon_smiley_29" data-title="[ÊÇ†Èó≤]" style="background-position:0 -540px;"></span>
            </li>

            <li class="emotions_item">
              <span class="icon_emotion_sprite js_emotion_i" data-name="icon_smiley_30" data-title="[Â•ãÊñó]" style="background-position:0 -560px;"></span>
            </li>

            <li class="emotions_item">
              <span class="icon_emotion_sprite js_emotion_i" data-name="icon_smiley_31" data-title="[ÂííÈ™Ç]" style="background-position:0 -580px;"></span>
            </li>

            <li class="emotions_item">
              <span class="icon_emotion_sprite js_emotion_i" data-name="icon_smiley_32" data-title="[ÁñëÈóÆ]" style="background-position:0 -600px;"></span>
            </li>

            <li class="emotions_item">
              <span class="icon_emotion_sprite js_emotion_i" data-name="icon_smiley_33" data-title="[Âòò]" style="background-position:0 -620px;"></span>
            </li>

            <li class="emotions_item">
              <span class="icon_emotion_sprite js_emotion_i" data-name="icon_smiley_34" data-title="[Êôï]" style="background-position:0 -640px;"></span>
            </li>

            <li class="emotions_item">
              <span class="icon_emotion_sprite js_emotion_i" data-name="icon_smiley_36" data-title="[Ë°∞]" style="background-position:0 -660px;"></span>
            </li>

            <li class="emotions_item">
              <span class="icon_emotion_sprite js_emotion_i" data-name="icon_smiley_37" data-title="[È™∑È´Ö]" style="background-position:0 -680px;"></span>
            </li>

            <li class="emotions_item">
              <span class="icon_emotion_sprite js_emotion_i" data-name="icon_smiley_38" data-title="[Êï≤Êâì]" style="background-position:0 -700px;"></span>
            </li>

            <li class="emotions_item">
              <span class="icon_emotion_sprite js_emotion_i" data-name="icon_smiley_39" data-title="[ÂÜçËßÅ]" style="background-position:0 -720px;"></span>
            </li>

            <li class="emotions_item">
              <span class="icon_emotion_sprite js_emotion_i" data-name="icon_smiley_40" data-title="[Êì¶Ê±ó]" style="background-position:0 -740px;"></span>
            </li>

            <li class="emotions_item">
              <span class="icon_emotion_sprite js_emotion_i" data-name="icon_smiley_41" data-title="[Êä†Èºª]" style="background-position:0 -760px;"></span>
            </li>

            <li class="emotions_item">
              <span class="icon_emotion_sprite js_emotion_i" data-name="icon_smiley_42" data-title="[ÈºìÊéå]" style="background-position:0 -780px;"></span>
            </li>

            <li class="emotions_item">
              <span class="icon_emotion_sprite js_emotion_i" data-name="icon_smiley_44" data-title="[ÂùèÁ¨ë]" style="background-position:0 -800px;"></span>
            </li>

            <li class="emotions_item">
              <span class="icon_emotion_sprite js_emotion_i" data-name="icon_smiley_45" data-title="[Â∑¶ÂìºÂìº]" style="background-position:0 -820px;"></span>
            </li>

            <li class="emotions_item">
              <span class="icon_emotion_sprite js_emotion_i" data-name="icon_smiley_46" data-title="[Âè≥ÂìºÂìº]" style="background-position:0 -840px;"></span>
            </li>

            <li class="emotions_item">
              <span class="icon_emotion_sprite js_emotion_i" data-name="icon_smiley_47" data-title="[ÂìàÊ¨†]" style="background-position:0 -860px;"></span>
            </li>

            <li class="emotions_item">
              <span class="icon_emotion_sprite js_emotion_i" data-name="icon_smiley_48" data-title="[ÈÑôËßÜ]" style="background-position:0 -880px;"></span>
            </li>

            <li class="emotions_item">
              <span class="icon_emotion_sprite js_emotion_i" data-name="icon_smiley_49" data-title="[ÂßîÂ±à]" style="background-position:0 -900px;"></span>
            </li>

            <li class="emotions_item">
              <span class="icon_emotion_sprite js_emotion_i" data-name="icon_smiley_50" data-title="[Âø´Âì≠‰∫Ü]" style="background-position:0 -920px;"></span>
            </li>

            <li class="emotions_item">
              <span class="icon_emotion_sprite js_emotion_i" data-name="icon_smiley_51" data-title="[Èò¥Èô©]" style="background-position:0 -940px;"></span>
            </li>

            <li class="emotions_item">
              <span class="icon_emotion_sprite js_emotion_i" data-name="icon_smiley_52" data-title="[‰∫≤‰∫≤]" style="background-position:0 -960px;"></span>
            </li>

            <li class="emotions_item">
              <span class="icon_emotion_sprite js_emotion_i" data-name="icon_smiley_54" data-title="[ÂèØÊÄú]" style="background-position:0 -980px;"></span>
            </li>

            <li class="emotions_item">
              <span class="icon_emotion_sprite js_emotion_i" data-name="icon_smiley_55" data-title="[ËèúÂàÄ]" style="background-position:0 -1000px;"></span>
            </li>

            <li class="emotions_item">
              <span class="icon_emotion_sprite js_emotion_i" data-name="icon_smiley_56" data-title="[Ë•øÁìú]" style="background-position:0 -1020px;"></span>
            </li>

            <li class="emotions_item">
              <span class="icon_emotion_sprite js_emotion_i" data-name="icon_smiley_57" data-title="[Âï§ÈÖí]" style="background-position:0 -1040px;"></span>
            </li>

            <li class="emotions_item">
              <span class="icon_emotion_sprite js_emotion_i" data-name="icon_smiley_60" data-title="[ÂíñÂï°]" style="background-position:0 -1060px;"></span>
            </li>

            <li class="emotions_item">
              <span class="icon_emotion_sprite js_emotion_i" data-name="icon_smiley_62" data-title="[Áå™Â§¥]" style="background-position:0 -1080px;"></span>
            </li>

            <li class="emotions_item">
              <span class="icon_emotion_sprite js_emotion_i" data-name="icon_smiley_63" data-title="[Áé´Áë∞]" style="background-position:0 -1100px;"></span>
            </li>

            <li class="emotions_item">
              <span class="icon_emotion_sprite js_emotion_i" data-name="icon_smiley_64" data-title="[ÂáãË∞¢]" style="background-position:0 -1120px;"></span>
            </li>

            <li class="emotions_item">
              <span class="icon_emotion_sprite js_emotion_i" data-name="icon_smiley_65" data-title="[Âò¥Âîá]" style="background-position:0 -1140px;"></span>
            </li>

            <li class="emotions_item">
              <span class="icon_emotion_sprite js_emotion_i" data-name="icon_smiley_66" data-title="[Áà±ÂøÉ]" style="background-position:0 -1160px;"></span>
            </li>

            <li class="emotions_item">
              <span class="icon_emotion_sprite js_emotion_i" data-name="icon_smiley_67" data-title="[ÂøÉÁ¢é]" style="background-position:0 -1180px;"></span>
            </li>

            <li class="emotions_item">
              <span class="icon_emotion_sprite js_emotion_i" data-name="icon_smiley_68" data-title="[ËõãÁ≥ï]" style="background-position:0 -1200px;"></span>
            </li>

            <li class="emotions_item">
              <span class="icon_emotion_sprite js_emotion_i" data-name="icon_smiley_70" data-title="[ÁÇ∏Âºπ]" style="background-position:0 -1220px;"></span>
            </li>

            <li class="emotions_item">
              <span class="icon_emotion_sprite js_emotion_i" data-name="icon_smiley_74" data-title="[‰æø‰æø]" style="background-position:0 -1240px;"></span>
            </li>

            <li class="emotions_item">
              <span class="icon_emotion_sprite js_emotion_i" data-name="icon_smiley_75" data-title="[Êúà‰∫Æ]" style="background-position:0 -1260px;"></span>
            </li>

            <li class="emotions_item">
              <span class="icon_emotion_sprite js_emotion_i" data-name="icon_smiley_76" data-title="[Â§™Èò≥]" style="background-position:0 -1280px;"></span>
            </li>

            <li class="emotions_item">
              <span class="icon_emotion_sprite js_emotion_i" data-name="icon_smiley_78" data-title="[Êã•Êä±]" style="background-position:0 -1300px;"></span>
            </li>

            <li class="emotions_item">
              <span class="icon_emotion_sprite js_emotion_i" data-name="icon_smiley_79" data-title="[Âº∫]" style="background-position:0 -1320px;"></span>
            </li>

            <li class="emotions_item">
              <span class="icon_emotion_sprite js_emotion_i" data-name="icon_smiley_80" data-title="[Âº±]" style="background-position:0 -1340px;"></span>
            </li>

            <li class="emotions_item">
              <span class="icon_emotion_sprite js_emotion_i" data-name="icon_smiley_81" data-title="[Êè°Êâã]" style="background-position:0 -1360px;"></span>
            </li>

            <li class="emotions_item">
              <span class="icon_emotion_sprite js_emotion_i" data-name="icon_smiley_82" data-title="[ËÉúÂà©]" style="background-position:0 -1380px;"></span>
            </li>

            <li class="emotions_item">
              <span class="icon_emotion_sprite js_emotion_i" data-name="icon_smiley_83" data-title="[Êä±Êã≥]" style="background-position:0 -1400px;"></span>
            </li>

            <li class="emotions_item">
              <span class="icon_emotion_sprite js_emotion_i" data-name="icon_smiley_84" data-title="[ÂãæÂºï]" style="background-position:0 -1420px;"></span>
            </li>

            <li class="emotions_item">
              <span class="icon_emotion_sprite js_emotion_i" data-name="icon_smiley_85" data-title="[Êã≥Â§¥]" style="background-position:0 -1440px;"></span>
            </li>

            <li class="emotions_item">
              <span class="icon_emotion_sprite js_emotion_i" data-name="icon_smiley_89" data-title="[OK]" style="background-position:0 -1460px;"></span>
            </li>

            <li class="emotions_item">
              <span class="icon_emotion_sprite js_emotion_i" data-name="icon_smiley_92" data-title="[Ë∑≥Ë∑≥]" style="background-position:0 -1480px;"></span>
            </li>

            <li class="emotions_item">
              <span class="icon_emotion_sprite js_emotion_i" data-name="icon_smiley_93" data-title="[ÂèëÊäñ]" style="background-position:0 -1500px;"></span>
            </li>

            <li class="emotions_item">
              <span class="icon_emotion_sprite js_emotion_i" data-name="icon_smiley_94" data-title="[ÊÄÑÁÅ´]" style="background-position:0 -1520px;"></span>
            </li>

            <li class="emotions_item">
              <span class="icon_emotion_sprite js_emotion_i" data-name="icon_smiley_95" data-title="[ËΩ¨Âúà]" style="background-position:0 -1540px;"></span>
            </li>

            <li class="emotions_item">
              <span class="icon_emotion_sprite js_emotion_i" data-name="icon_emoji_ios_0" data-title="üòÑ" style="background-position:0 -1560px;"></span>
            </li>

            <li class="emotions_item">
              <span class="icon_emotion_sprite js_emotion_i" data-name="icon_emoji_ios_1" data-title="üò∑" style="background-position:0 -1580px;"></span>
            </li>

            <li class="emotions_item">
              <span class="icon_emotion_sprite js_emotion_i" data-name="icon_emoji_ios_2" data-title="üòÇ" style="background-position:0 -1600px;"></span>
            </li>

            <li class="emotions_item">
              <span class="icon_emotion_sprite js_emotion_i" data-name="icon_emoji_ios_3" data-title="üòù" style="background-position:0 -1620px;"></span>
            </li>

            <li class="emotions_item">
              <span class="icon_emotion_sprite js_emotion_i" data-name="icon_emoji_ios_4" data-title="üò≥" style="background-position:0 -1640px;"></span>
            </li>

            <li class="emotions_item">
              <span class="icon_emotion_sprite js_emotion_i" data-name="icon_emoji_ios_5" data-title="üò±" style="background-position:0 -1660px;"></span>
            </li>

            <li class="emotions_item">
              <span class="icon_emotion_sprite js_emotion_i" data-name="icon_emoji_ios_6" data-title="üòî" style="background-position:0 -1680px;"></span>
            </li>

            <li class="emotions_item">
              <span class="icon_emotion_sprite js_emotion_i" data-name="icon_emoji_ios_7" data-title="üòí" style="background-position:0 -1700px;"></span>
            </li>

            <li class="emotions_item">
              <span class="icon_emotion_sprite js_emotion_i" data-name="icon_emoji_wx_4" data-title="[ÂòøÂìà]" style="background-position:0 -1720px;"></span>
            </li>

            <li class="emotions_item">
              <span class="icon_emotion_sprite js_emotion_i" data-name="icon_emoji_wx_5" data-title="[ÊçÇËÑ∏]" style="background-position:0 -1740px;"></span>
            </li>

            <li class="emotions_item">
              <span class="icon_emotion_sprite js_emotion_i" data-name="icon_emoji_wx_2" data-title="[Â•∏Á¨ë]" style="background-position:0 -1760px;"></span>
            </li>

            <li class="emotions_item">
              <span class="icon_emotion_sprite js_emotion_i" data-name="icon_emoji_wx_6" data-title="[Êú∫Êô∫]" style="background-position:0 -1780px;"></span>
            </li>

            <li class="emotions_item">
              <span class="icon_emotion_sprite js_emotion_i" data-name="icon_emoji_wx_12" data-title="[Áö±Áúâ]" style="background-position:0 -1800px;"></span>
            </li>

            <li class="emotions_item">
              <span class="icon_emotion_sprite js_emotion_i" data-name="icon_emoji_wx_11" data-title="[ËÄ∂]" style="background-position:0 -1820px;"></span>
            </li>

            <li class="emotions_item">
              <span class="icon_emotion_sprite js_emotion_i" data-name="icon_emoji_ios_8" data-title="üëª" style="background-position:0 -1840px;"></span>
            </li>

            <li class="emotions_item">
              <span class="icon_emotion_sprite js_emotion_i" data-name="icon_emoji_ios_9" data-title="üôè" style="background-position:0 -1860px;"></span>
            </li>

            <li class="emotions_item">
              <span class="icon_emotion_sprite js_emotion_i" data-name="icon_emoji_ios_10" data-title="üí™" style="background-position:0 -1880px;"></span>
            </li>

            <li class="emotions_item">
              <span class="icon_emotion_sprite js_emotion_i" data-name="icon_emoji_ios_11" data-title="üéâ" style="background-position:0 -1900px;"></span>
            </li>

            <li class="emotions_item">
              <span class="icon_emotion_sprite js_emotion_i" data-name="icon_emoji_ios_12" data-title="[Á§ºÁâ©]" style="background-position:0 -1920px;"></span>
            </li>

            <li class="emotions_item">
              <span class="icon_emotion_sprite js_emotion_i" data-name="icon_emoji_wx_9" data-title="[Á∫¢ÂåÖ]" style="background-position:0 -1940px;"></span>
            </li>

            <li class="emotions_item">
              <span class="icon_emotion_sprite js_emotion_i" data-name="icon_emoji_wx_14" data-title="[È∏°]" style="background-position:0 -1960px;"></span>
            </li>

            <li class="emotions_item">
              <span class="icon_emotion_sprite js_emotion_i" data-name="" data-title="" style="background-position:0 -2660px;"></span>
            </li>

            <li class="emotions_item">
              <span class="icon_emotion_sprite js_emotion_i" data-name="" data-title="" style="background-position:0 -2660px;"></span>
            </li>

            <li class="emotions_item">
              <span class="icon_emotion_sprite js_emotion_i" data-name="" data-title="" style="background-position:0 -2660px;"></span>
            </li>

            <li class="emotions_item">
              <span class="icon_emotion_sprite js_emotion_i" data-name="" data-title="" style="background-position:0 -2660px;"></span>
            </li>

            <li class="emotions_item">
              <span class="icon_emotion_sprite js_emotion_i" data-name="" data-title="" style="background-position:0 -2660px;"></span>
            </li>

            <li class="emotions_item">
              <span class="icon_emotion_sprite js_emotion_i" data-name="" data-title="" style="background-position:0 -2660px;"></span>
            </li>

            <li class="emotions_item">
              <span class="icon_emotion_sprite js_emotion_i" data-name="" data-title="" style="background-position:0 -2660px;"></span>
            </li>

            <li class="emotions_item">
              <span class="icon_emotion_sprite js_emotion_i" data-name="" data-title="" style="background-position:0 -2660px;"></span>
            </li>

            <li class="emotions_item">
              <span class="icon_emotion_sprite js_emotion_i" data-name="" data-title="" style="background-position:0 -2660px;"></span>
            </li>

            <li class="emotions_item">
              <span class="icon_emotion_sprite js_emotion_i" data-name="" data-title="" style="background-position:0 -2660px;"></span>
            </li>

            <li class="emotions_item">
              <span class="icon_emotion_sprite js_emotion_i" data-name="" data-title="" style="background-position:0 -2660px;"></span>
            </li>

            <li class="emotions_item">
              <span class="icon_emotion_sprite js_emotion_i" data-name="" data-title="" style="background-position:0 -2660px;"></span>
            </li>

            <li class="emotions_item">
              <span class="icon_emotion_sprite js_emotion_i" data-name="" data-title="" style="background-position:0 -2660px;"></span>
            </li>

          </ul>
          <span class="emotions_preview js_emotionPreviewArea"></span>
        </div>
      </div>
    </div>

  </div>

</template>
<script>
  import { on, off } from 'element-ui/src/utils/dom';
  String.prototype.splice = function(idx, rem, str) {
    return this.slice(0, idx) + str + this.slice(idx + Math.abs(rem));
  };
  export default {
    props: ['value'],
    data() {
      return {
        emotions_show: false,
        innerText: this.value
      }
    },
    methods: {
      trigger_emotions: function() {
        if(!this.emotions_show){
          this.emotions_show = true;
        }
      },
      changeText($event) {
        this.innerText = $event.currentTarget.innerHTML;
        this.$emit('input', this.innerText)
      },
      getCaretPosition: function() {
          var oField = this.$el.querySelector('.js_editorArea')
          var iCaretPos = 0;
          var doc = oField.ownerDocument || oField.document;
          var win = doc.defaultView || doc.parentWindow;
          var sel;
          if (typeof win.getSelection != "undefined") {
              sel = win.getSelection();
              if (sel.rangeCount > 0) {
                  var range = win.getSelection().getRangeAt(0);
                  var preCaretRange = range.cloneRange();
                  preCaretRange.selectNodeContents(oField);
                  preCaretRange.setEnd(range.endContainer, range.endOffset);
                  // iCaretPos = preCaretRange.toString().length;
                  iCaretPos = {startOffset:range.startOffset,endOffset:range.endOffset}
              }
          } else if ( (sel = doc.selection) && sel.type !== 'Control') {
              var textRange = sel.createRange();
              var preCaretTextRange = doc.body.createTextRange();
              preCaretTextRange.moveToElementText(oField);
              preCaretTextRange.setEndPoint('EndToEnd', textRange);
              iCaretPos = preCaretTextRange.text.length;
          }
          return (iCaretPos);
      }
    },
    mounted() {
      on(document, 'click', ()=>{
        if(this.emotions_show == true){
          this.emotions_show = false
        }
      });
      this.$el.querySelectorAll('.emotions_item').forEach((el)=> {
        on(el, 'click', ()=>{
          let $js_emotion_i = el.querySelector('.js_emotion_i')
          let emotion = $js_emotion_i.getAttribute('data-title');
          console.log(this.getCaretPosition())
          var iCaretPos = this.getCaretPosition()
          if(iCaretPos==0){
            this.innerText+=emotion;
          }else{
            this.innerText = this.innerText.splice(iCaretPos.startOffset,iCaretPos.endOffset-iCaretPos.startOffset,emotion)
          }
          var $js_editorArea = this.$el.querySelector('.js_editorArea')
          $js_editorArea.focus();
          console.log(emotion)
        })
      })
    }
  }
</script>
<style scoped>
body, h1, h2, h3, h4, h5, h6, p, ul, ol, dl, dd, fieldset, textarea {
    margin: 0;
}
ul, ol {
    padding-left: 0;
    list-style-type: none;
}body, h1, h2, h3, h4, h5, h6, p, ul, ol, dl, dd, fieldset, textarea {
    margin: 0;
}
.emotion_editor {
    position: relative;
    z-index: 1;
    border: 1px solid #e7e7eb;
    border-radius: 0;
    -moz-border-radius: 0;
    -webkit-border-radius: 0;
}.emotion_editor .edit_area {
    padding: 14px 20px;
    outline: 0;
    word-wrap: break-word;
    word-break: break-all;
    border-top-left-radius: 0;
    -moz-border-radius-topleft: 0;
    -webkit-border-top-left-radius: 0;
    border-top-right-radius: 0;
    -moz-border-radius-topright: 0;
    -webkit-border-top-right-radius: 0;
    background-color: #fff;
    height: 188px;
}.menu_form_area .msg_sender .emotion_editor .edit_area {
    height: 151px;
}.editor_toolbar {
    overflow: hidden;
    padding-bottom: 10px;
    border-bottom: 1px solid #e7e7eb;
}.editor_toolbar {
    padding: 0 20px;
    line-height: 36px;
    background-color: #fff;
    border-top: 1px solid #e7e7eb;
}.menu_form_area .msg_sender .editor_toolbar {
    border-bottom: 0;
    padding-bottom: 0;
}.editor_tip {
    float: right;
    color: #8d8d8d;
}a {
    color: #459ae9;
}.emotion_switch {
    float: left;
    margin-top: 8px;
    height: 28px;
    line-height: 999em;
    overflow: hidden;
}.icon_emotion.emotion_switch {
    background: url(../img/emotion_editor_z3518e7.png) 0 0 no-repeat;
    width: 20px;
    height: 20px;
    vertical-align: middle;
    display: inline-block;
}.icon_emotion.emotion_switch:hover {
    background: url(../img/emotion_editor_z3518e7.png) 0 -24px no-repeat;
}.emotion_wrp {
    position: absolute;
    width: 401px;
    top: 100%;
    left: -1px;
}.hook {
    position: absolute;
    left: 21px;
    top: 0;
}.hook .hook_dec {
    position: absolute;
    left: 0;
    width: 0;
    height: 0;
    border-style: solid;
    border-width: 8px;
}.hook .hook_top {
    top: -16px;
    border-color: transparent transparent #c0bfc5;
}.hook .hook_dec {
    position: absolute;
    left: 0;
    width: 0;
    height: 0;
    border-style: solid;
    border-width: 8px;
}.hook .hook_btm {
    top: -15px;
    border-color: transparent transparent #f6f6f6;
}.emotions {
    -moz-user-select: none;
    overflow: hidden;
    border-top: 1px solid #c0bfc5;
    border-right: 1px solid #c0bfc5;
    background-color: #e7e7eb;
}.emotions_item {
    float: left;
    width: 24px;
    height: 24px;
    line-height: 24px;
    font-size: 0;
    text-align: center;
    border-bottom: 1px solid #c0bfc5;
    border-left: 1px solid #c0bfc5;
    background-color: #fff;
}.icon_emotion_sprite {
    cursor: pointer;
    width: 20px;
    height: 20px;
    vertical-align: middle;
    display: inline-block;
    background: transparent url(../img/icon_emotion_panel.2x3518e6.png) no-repeat 0 0;
    -webkit-background-size: 20px auto;
    background-size: 20px auto;
}
</style>
